[Unit]
Description=Unicorn Server

[Service]
User=<%= scope['user::deployer::username'] %>
Group=<%= scope['user::deployer::group'] %>
WorkingDirectory=<%= scope['vars::apps_root'] %>/<%= @fqdn %>/current
Environment=RAILS_ENV=<%= @productname == 'VirtualBox' ? 'sandbox' : 'production' %>
SyslogIdentifier=unicorn
PIDFile=/tmp/unicorn.pid

ExecStart=<%= scope['user::deployer::home'] %>/.rbenv/shims/bundle exec \
  "<%= scope['vars::apps_root'] %>/<%= @fqdn %>/current/bin/unicorn -D -c \
  <%= scope['vars::apps_root'] %>/<%= @fqdn %>/current/config/unicorn.rb -E \
  <%= @productname == 'VirtualBox' ? 'sandbox' : 'production' %>"

ExecStop=/bin/kill -s QUIT $MAINPID
ExecReload=/bin/kill -s USR2 $MAINPID

[Install]
WantedBy=multi-user.target
