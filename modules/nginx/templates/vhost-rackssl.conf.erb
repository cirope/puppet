<%= scope.function_template(['nginx/vhost/_unicorn.conf.erb']) %>

server {
  listen 80 default deferred;
  server_name  ~^(?<subdomain>.+)?(?<domain>\.<%= @fqdn.gsub('.', '\.') %>)$;
  rewrite      ^ https://$subdomain$domain$request_uri? permanent;
}

server {
  listen 443 default deferred spdy;

  <%= scope.function_template(['nginx/vhost/_rackserver.conf.erb']) %>
  <%= scope.function_template(['nginx/vhost/_ssl.conf.erb']) %>
  <%= scope.function_template(['nginx/vhost/_rackapp.conf.erb']) %>
}
